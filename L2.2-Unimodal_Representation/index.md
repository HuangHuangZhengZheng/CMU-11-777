# Unimodal Representation


## Visual Representation

ResNet

what is the shape of the feature map?

在 ResNet 中，残差相加操作 \( f(x) + x \) 需要确保 \( f(x) \) 和 \( x \) 的形状相同，以便可以逐元素相加。如果 \( f(x) \) 和 \( x \) 的形状不同，需要通过一些方法来匹配它们的形状。

1. **当空间维度相同时**
   - 如果 \( f(x) \) 和 \( x \) 的空间维度相同（高度和宽度相同），但通道数不同，可以通过在残差块中使用 1×1 的卷积层来调整 \( x \) 的通道数，使其与 \( f(x) \) 的通道数相同。这种 1×1 的卷积层通常称为“匹配卷积”（matching convolution）或“投影卷积”（projection convolution）。

2. **当空间维度不同时**
   - 如果 \( f(x) \) 和 \( x \) 的空间维度不同（例如，\( f(x) \) 的高度和宽度是 \( x \) 的一半），需要通过下采样（downsampling）来减小 \( x \) 的空间维度，使其与 \( f(x) \) 相同。常见的下采样方法包括使用步幅大于 1 的卷积层或最大池化层。
   - 同时，为了匹配通道数，也可以使用 1×1 的卷积层来调整 \( x \) 的通道数。

3. **具体实现**
   - 在 ResNet 的实现中，通常在残差块的开始部分使用一个 1×1 的卷积层来调整 \( x \) 的通道数，并使用步幅大于 1 的卷积层来下采样 \( x \) 的空间维度。这样，经过调整后的 \( x \) 可以与 \( f(x) \) 进行逐元素相加。

例如，假设 \( x \) 的形状为 \([N, C_{\text{in}}, H, W]\)，而 \( f(x) \) 的形状为 \([N, C_{\text{out}}, H/2, W/2]\)。为了完成残差相加操作，可以使用以下步骤：

1. 使用 1×1 的卷积层将 \( x \) 的通道数从 \( C_{\text{in}} \) 调整为 \( C_{\text{out}} \)。
2. 使用步幅为 2 的卷积层或最大池化层将 \( x \) 的空间维度从 \([H, W]\) 下采样为 \([H/2, W/2]\)。

经过这些调整后，\( x \) 的形状将变为 \([N, C_{\text{out}}, H/2, W/2]\)，与 \( f(x) \) 的形状相同，可以进行逐元素相加。

总结：
- 为了完成残差相加操作 \( f(x) + x \)，需要确保 \( f(x) \) 和 \( x \) 的形状相同。如果它们的形状不同，可以通过使用 1×1 的卷积层来调整通道数，并使用下采样方法来调整空间维度。




